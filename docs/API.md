## API

Это список функций и сигналов, с помощью которых клиент может взаимодействовать с сервером.

Вот несколько правил, по которым устроено API.

- Пометка `io` обозначает, что данные передаются по протоколу `socketio`.
  - Если сигнал начинается с `c`, значит его отправляет клиент.
  - Если сигнал начинается с `s`, значит его отправляет сервер.
- Пометка `GET` обозначает, что данные передаются по протоколу `HTTP` методом `GET`.

Все данные по протоколу `HTTP` в теле запроса в формате `JSON` по адресу `.../function` , где `function` — название функции.<br>
Все `socketio` запросы происходят по socket.io-адресу по умолчанию.

(MVP) При входе в комнату спрашивается юзернейм игрока. При выходе из комнаты юзернейм удаляется.

#### Организационное

__1.__ `GET` `getRoomInfo` - функция получения информации о комнате по ключу

Тело:

- `key` - ключ комнаты, информация о которой нужна.

Ответ:

- `success (bool)` - сли ключ комнаты не валидный, `success = false`.
- `state (string)` - состояние комнаты.
    - `wait` -  Идёт набор игроков либо комната не создана.
    - `play` - идёт игра. Подключится можно только по имени из списка.
    - `end` - игра закончена.
- `playerList` - Если `status = wait, play`. Список игроков.
  - `username (string)`
  - `online (bool)` 
- `results (array)` - Если `status = end`. Список результатов по убыванию. (MVP-next) Каждый результат хранит:
    - `username (string)` - имя игрока.
    - `scoreExplained (int)` - количество объяснённых слов.
    - `scoreGuessed (int)` - количество отгаданных слов.

---

__2.__ `GET` `getFreeKey` - функция получения свободного ключа комнаты

Ответ:

- `key (string)` - ключ

---

__3.__ `io` `cJoinRoom` - функция, присоединяющая игрока к комнате.

Хранит:

- `key (string)` - ключ комнаты.
- `username (string)` - имя игрока.

---

__4.__ `io` `cLeaveRoom` - функция, удаляющая игрока из комнаты.

Хранит:

- `username (string)` - имя игрока.

---


__5.__ `io` `sPlayerJoined` - сигнал, посылаемый сервером всем клиентам в комнате при присоединении нового игрока.

Хранит:

- `username (string)` -- имя вошедшего игрока.
- `playerList (array)` - список игроков.
  - `username (string)`
  - `online (bool)`

---

__6.__ `io` `sPlayerLeft` - сигнал, посылаемый сервером всем клиентам в комнате при уходе игрока.

  Хранит:

- `username (string)` - имя ушедшего игрока.
- `playerList (array)` - список игроков.
  - `username (string)`
  - `online (bool)`

---

__7.__ `io` `sYouJoined` - сигнал, посылаемый сервером при удачном подключении.

Хранит:

- `key (string)` - ключ комнаты, в которую подключились.
- `state (string)` -- состояние комнаты.
  - `wait` -  Идёт набор игроков либо комната не создана.
  - `play` - идёт игра. Подключится можно только по имени из списка.
  - `end` - игра закончена.
- `substate (string)` - Если `state = play`. Состояние комнаты во время игры.
  - `wait` - жидаем готовности объясняющего и слушающего.
  - `explanation` - дёт объяснение слова.
  - `edit` - вносятся правки в прошедший раунд.
- `playerList` - список игроков.
  - `username (string)`
  - `online (bool)`
- `wordsCount (int)` - кол-во оставшихся слов.

Если `substate = wait`:

- `who (string)` - Кто будет объяснять.
- `whom (string)` - Кому будут объяснять.

Если `substate = explanation`:

- `who (string)` - Кто объясняет.
- `whom (string)` - Кому объясняют.
- `word (string)` - Если запрос от `speaker`. Слово для объяснения.
- `endTime` - Время окончания объяснения.

Если `substate = edit`:

- `editWords (array)` - Список слов для правки.
  + `word (string)`
  + `wordState (string)`
    * `notExplained` - слово не было объяснено.
    * `explained` - слово было объянено.
    * `mistake` - слово было объяснено с ошибкой.

---

__8.__ `io` `sNewHost` - сигнал, посылаемый сервером всем клиентам при смене хоста.

Хранит:

- `username (string)` - имя нового хоста.

---

__9.__ `io` `sFailure` - сообщение об ошибке.

Хранит:

- `request (string)` - какой запрос не получилось выполнить. (Например `cJoinRoom`).
- `msg (string)` - причина .

#### Игра

__10.__ `io` `cStartGame` - функция, начинающая игру.

---

__11.__ `io` `sGameStarted` - сигнал, посылаемый сервером всем клинтом, когда игра началась.

---

__12.__ `io` `sNextTurn` - сигнал, посылаемый сервером всем клиентам в начале хода.

Хранит:

- `who (string)` - имя следующего объясняющего.
- `whom (string)` - имя того, кому будут объясняют.

---

__13.__ `io` `cListenerReady` - функция, вызов которой обозначает, что игрок готов угадывать слова.

---

__14.__ `io` `cSpeakerReady` - функция, вызов которой обозначает, что игрок готов объяснять слова.

---

__15.__ `io` `sExplanationStarted` - сигнал, посылаемый сервером всем клиента в начале объяснения слов.

---

__16.__ `io` `sNewWord` - сигнал, посылаемый сервером, когда нужно сообщить слово для объяснения.

Хранит:

- `word` - слово для объяснения.

---

__17.__ `io` `сEndWordExplanation` - функция, вызов которой обозначает, что игрок закончил объяснять текущее слово.

Хранит:

- `cause (string)` - причина окончания объяснения.
  - `explained` - слово было объяснено.
  - `timeout` - конец игры последнее слово было либо угадано, либо – нет.
  - `explanationError` - ошибка в объяснении.
  - `surrender` - игрок сдался.

---

__18.__ `io` `sWordExplanationEnded` - сигнал, посылаемый всем клиентам (может кроме `speaker`) когда объяснение одного слова закончилось.

- `cause (string)` - причина окончания объяснения.
  - `explained` - слово было объяснено.
  - `timeout` - конец игры последнее слово было либо угадано, либо – нет.
  - `explanationError` - ошибка в объяснении.
  - `surrender` - игрок сдался.
- `word (string)` - Если `cause != timeout`. Слово, которое объяснялось.
- `wordsCount (int)` - количество оставшихся слов.

---

__19.__ `io` `sExplanationFinished` - сигнал о конце объяснения слов.

- `wordsCount (int)` - количество оставшихся слов.

---

__20.__ `io` `cEdited` - сигнал, посылаемый клиентом когда все правки внесены.

- `editWords (array)` - Список слов с внесёнными правками.
  + `word (string)`
  + `wordState (string)`
    * `notExplained` - слово не было объяснено.
    * `explained` - слово было объяснено.
    * `mistake` - слово было объяснено с ошибкой.

---

__21.__ `io` `sGameEnded` - сигнал о конце игры

Хранит:

- `results (array)` - Список результатов по убыванию.
    - `username (string)` - имя игрока.
    - `scoreExplained (int)` - количество объяснённых слов.
    - `scoreGuessed (int)` - количество отгаданных слов.

